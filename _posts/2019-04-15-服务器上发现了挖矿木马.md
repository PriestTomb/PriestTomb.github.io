---
layout: post
title: 服务器上发现了挖矿木马
date: 2019-04-15
categories:
- 日常
tags: [云服务器, 木马病毒]
status: publish
type: post
published: true
author:
  login: PriestTomb
  email: mxingzh@163.com
  display_name: PriestTomb
---

# 发现异样

上周同事说云服务器上有个不知道什么的程序几乎占满了所有 CPU 资源，杀掉还会自动重启，怀疑是不是中病毒了

稍微留意了一下，登上去看了其他的服务器，果然也都有相似的进程在疯狂运行

![top查看.png](https://i.loli.net/2019/04/15/5cb48a4de82b9.png)

到群里随意吐个槽说刚开几天的云服务器好像就中毒了，一个前同事接了句“挖矿的？”

---

# 查查是啥

本来没什么头绪，被这么一问，觉得还真可能是，就搜了一下挖矿木马，看了几篇博客，跟遇到的状况非常相似

查一下 crontab：

![crontab查看.png](https://i.loli.net/2019/04/15/5cb48a4dde999.png)

噫。。果然有点东西

看了下这个地址的 shell 脚本：

![shell脚本内容.png](https://i.loli.net/2019/04/15/5cb48a4de9c1c.png)

虽然对 Linux 的各种命令不是非常熟，但好歹也是看出来是木马没跑了

这个 ddgs ，网上搜了下，好像是说挖矿木马 ddg 的变种，而且这个种木马的小伙汁应该是还在时不时的更新挖矿脚本，看最后两行，他把当前的脚本命名为 \*\*\*bce，估计 \*\*\*bcb 和 \*\*\*bcd 是旧版本的脚本吧，启新的之后把旧的给杀了。。

---

# 处理一哈

搞明白是怎么回事之后，把这个问题反馈给领导，领导安排同事先去看看解决一下，因为手头还有一堆任务，就没去看他们怎么解决的

不过竖着耳朵听他们讨论，大概也就是网上的那些步骤，清掉定时任务，查删木马程序，加强一下用户密码，改一改 ssh 端口、软件端口之类的

好在折腾一番之后，这几天没看到“复发”的迹象

其实感觉挺水的，没去细查服务器到底是怎么被破的，是 root 用户弱密码直接爆破？还是服务在用的几个组件有什么漏洞？也没能跟木马作者来上几个回合的交战，稍微做点措施就没有后续了

---

# 值得深思

上个月刚把手头习惯在用的破解版 XShell 卸掉，换成了 MobaXterm，原因本来是为了自己的搬瓦工主机安全，经过这次服务器中毒，感觉手头还剩下的几个破解软件也要尽快用开源或免费产品替换掉，亦或是尽早让自己习惯买正版软件。。

说实话，还是会觉得某些软件好贵，内心还是希望能挖掘到更多优秀的开源产品。。

这几天刚找到两个：

[百度脑图](https://github.com/fex-team/kityminder)：能打开、编辑常见的脑图文件比如 .xmind、.mmap 之类的，挺方便使用

[OmniDB](https://github.com/OmniDB/OmniDB)：Web 版的数据库管理工具，主要支持 PostgreSQL，对 MySQL 和 Oracle 也支持，只是有些功能还不是很完善的样子

找开源产品更多的是为了尝鲜、好玩，毕竟市面上各方面基本都有成熟的、更好用的主流产品

最近还有个小软件苦苦找不到实惠的替代品，就是 Proxifier，主流的同类型产品也不是免费的，而免费的几款都。。。是 N 年前就停更了（可能这就是免费产品的命吧。。）

这几天突发奇想，emm 不如自己写一个？虽然不太可能写出什么非常牛逼的东西来，不过就目前简单的“拦截发往某网段的网络请求全部使用 socks5 代理”这个需求。。应该能做出个东拼西凑的四不像来吧

反正也是打发时间，顺便研究下这个毫无头绪的东西怎么做，就酱
